{% extends 'index.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">Pilot Profile</h4>
    </div>
    <div class="card-body">
      
      <h5>User Information</h5>
      <ul class="list-group mb-4">
        <li class="list-group-item"><strong>First Name:</strong> {{ user.first_name }}</li>
        <li class="list-group-item"><strong>Last Name:</strong> {{ user.last_name }}</li>
        <li class="list-group-item"><strong>Email:</strong> {{ user.email }}</li>
      </ul>

      <h5>Pilot License Info</h5>
      <ul class="list-group mb-4">
        <li class="list-group-item"><strong>License Number:</strong> {{ profile.license_number|default:"Not provided" }}</li>
        <li class="list-group-item"><strong>License Date:</strong> {{ profile.license_date|date:"F j, Y"|default:"Not provided" }}</li>
        <li class="list-group-item">
          <strong>License Image:</strong>
          {% if profile.license_image %}
            <a href="{{ profile.license_image.url }}" target="_blank">View</a>
          {% else %}
            Not uploaded
          {% endif %}
        </li>
      </ul>

      <a href="{% url 'edit_pilot_profile' %}" class="btn btn-warning">Edit Profile</a>
      <a href="{% url 'delete_pilot_profile' %}" class="btn btn-danger">Delete Profile</a>

      <hr>

      <h3 class="mt-4">Training Records</h3>
      <a href="{% url 'add_training_record' %}" class="btn btn-sm btn-primary mb-3">Add Training</a>

      <table class="table table-bordered">
        <thead class="table-light">
          <tr>
            <th>Training Name</th>
            <th>Date</th>
            <th>Location</th>
            <th>Annual?</th>
            <th>Certificate</th>
            <th>Notes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for training in profile.trainings.all|dictsortreversed:"date_completed" %}
          <tr>
            <td>{{ training.training_name }}</td>
            <td>{{ training.date_completed }}</td>
            <td>{{ training.location }}</td>
            <td>{{ training.is_annual|yesno:"Yes,No" }}</td>
            <td>
              {% if training.certificate %}
                <a href="{{ training.certificate.url }}" target="_blank">View</a>
              {% else %}
                —
              {% endif %}
            </td>
            <td>{{ training.notes|default:"—" }}</td>
            <td>
              <a href="{% url 'edit_training_record' training.pk %}" class="btn btn-sm btn-warning">Edit</a>
              <a href="{% url 'delete_training_record' training.pk %}" class="btn btn-sm btn-danger">Delete</a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="7">No training records found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
